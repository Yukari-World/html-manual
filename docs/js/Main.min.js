import{storageAvailable,IndexedDBConnecter}from"./common.min.js";import{SendAjax}from"./ajax-response.min.js";const sideList=["Main","CSS","HTML","JavaScript","Language","Node","PHP","SCSS","SQL","Wordpress","Other"],startTime=Date.now(),dbName="Technical-Manual",dbVersion=1;let randomWordList,xorRand,roopEvent,bWordDecide=!1,sideToggle=[];class XorShift{constructor(e=Math.floor(Date.now()/1e3)){let t=new Date;this.x=Math.max(Math.floor(t.getDate()**((t.getMonth()+1)/4+2)),(t.getMonth()+1)*t.getDate()*Math.max(t.getSeconds()**2,31)*Math.max(t.getMinutes()**2,53)),this.y=Math.max(Math.max(t.getSeconds(),5)**Math.floor(Math.max(t.getMinutes(),10)/10)+Math.max(t.getSeconds(),1)*Math.max(t.getMinutes(),1)*Math.floor(t.getFullYear()/10)),this.z=randomWordList.length**4+(randomWordList[2].summary.length+randomWordList[3].summary.length+randomWordList[5].summary.length+randomWordList[7].summary.length)*(randomWordList[11].summary.length+randomWordList[13].summary.length+randomWordList[17].summary.length+randomWordList[19].summary.length)*(randomWordList[23].summary.length+randomWordList[29].summary.length)+(randomWordList[31].summary.length+randomWordList[37].summary.length),this.w=e,console.log("XorShift Seed Info:\nX: "+this.toHex(this.x)+" ("+this.x+")\nY: "+this.toHex(this.y)+" ("+this.y+")\nZ: "+this.toHex(this.z)+" ("+this.z+")\nW: "+this.toHex(this.w)+" ("+this.w+")")}toHex(e){return"0x"+("00000000"+e.toString(16).toUpperCase()).substr(-8)}randomInt32(){let e=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^e^e>>>8,this.w}randomFloat(){let e=this.randomInt32();return e<0&&(e=~e),e/(2**31-1)}}function getRandomWord(){return new Promise(function(e,t){SendAjax("json/randomWord.json",new FormData,"GET").then(function(t){e(t)}).catch(function(e){console.error("request failed",e),t(e)})})}function secondsInterval(e=5){let t=new Date;t.getSeconds()%e==0&&!1===bWordDecide?(bWordDecide=!0,setrandomWord()):t.getSeconds()%e==1&&!0===bWordDecide&&(bWordDecide=!1)}async function randomOutput(e){const t=document.getElementById("randomOutput"),n=document.createElement("dl");let o=0;n.setAttribute("id","RandomList"),t.textContent="",t.appendChild(n);const a=document.getElementById("RandomList");if(window.Worker){const e=new Worker("js/WorkerTask.min.js",{name:"Worker Task"});e.addEventListener("message",function(e){let t=e.data;switch(t.mode){case"listResult":a.insertAdjacentHTML("beforeend",t.post);break;case"tagList":console.log(t.post);break;default:console.log('Task mode "'+t.mode+'" is not found.')}}),e.addEventListener("messageerror",function(e){console.error("Task failed",e.data)}),e.postMessage({mode:"createRandList"})}else for(let t of e){const e=document.createElement("dt"),n=document.createElement("dd");e.setAttribute("id","wordID"+ ++o),e.insertAdjacentHTML("beforeend","<h3>"+t.title+"</h3><h4>出典: "+t.original+"</h4>"),n.insertAdjacentHTML("beforeend",t.summary),a.appendChild(e),a.appendChild(n)}}function setrandomWord(){let e=Math.floor(xorRand.randomFloat()*randomWordList.length);const t=document.getElementById("randomWord");t.setAttribute("href","scp-randomWord.html#wordID"+(e+1)),t.textContent="",t.insertAdjacentHTML("beforeend",randomWordList[e].title)}document.addEventListener("DOMContentLoaded",async function(){const e=storageAvailable("localStorage"),t="boxState";let n,o=!1;await getRandomWord().then(function(e){randomWordList=e}).catch(function(e){console.error(e)}),xorRand=new XorShift,!1!==(n=new IndexedDBConnecter(dbName,1))&&(n.initializeConnection(function(e){let n=e.target.result;n.createObjectStore(t,{keyPath:"id"}).transaction.addEventListener("complete",function(){let e=n.transaction(t,"readwrite").objectStore(t);for(let t of sideList)e.add({id:t,value:"false"})})}),n.dbTable=t,o=!0),document.getElementById("expandAll").addEventListener("click",function(){for(let t of sideList){const a=document.getElementById("btn"+t);if(document.getElementById("link"+t).checked=!0,sideToggle[t]="true",a.textContent="-",o){const e={id:t,value:"true"};n.setValue(e)}else e&&localStorage.setItem(t+"Toggle","true")}}),document.getElementById("collapseAll").addEventListener("click",function(){for(let t of sideList){const a=document.getElementById("btn"+t);if(document.getElementById("link"+t).checked=!1,sideToggle[t]="false",a.textContent="+",o){const e={id:t,value:"false"};n.setValue(e)}else e&&localStorage.setItem(t+"Toggle","false")}});for(let t of sideList){const a=document.getElementById("btn"+t),d=document.getElementById("link"+t);o?await n.getValue(t).then(function(e){sideToggle[t]=void 0!==e?e.value:"false"}).catch(function(e){console.error(e)}):sideToggle[t]=e?localStorage.getItem(t+"Toggle"):"false",null===sideToggle[t]||"false"===sideToggle[t]||(a.textContent="-",d.checked=!0),d.addEventListener("change",function(){if(null===sideToggle[t]||"false"===sideToggle[t]){if(sideToggle[t]="true",o){const e={id:t,value:"true"};n.setValue(e)}else e&&localStorage.setItem(t+"Toggle","true");a.textContent="-"}else{if(sideToggle[t]="false",o){const e={id:t,value:"false"};n.setValue(e)}else e&&localStorage.setItem(t+"Toggle","false");a.textContent="+"}})}const a=document.getElementById("countRandom");null!==a&&(a.textContent=randomWordList.length),null!==document.getElementById("randomOutput")&&randomOutput(randomWordList),setrandomWord(),roopEvent=setInterval(secondsInterval,50,10)}),window.addEventListener("load",function(){document.getElementById("LoadTime").textContent=Date.now()-startTime+" ms"});
//# sourceMappingURL=maps/Main.min.js.map