let randomWordList,sendList,randomWordTags=[];function checkStatus(e){if(e.status>=200&&e.status<300)return e;{let t=new Error(e.statusText);throw t.response=e,t}}function parseJSON(e){return e.json()}function SendAjax(e,t,o){return new Promise(function(n,s){if(self.fetch){let r,a;if("POST"===o||"post"===o)a=e,r={method:o,body:t};else{a=e+"?";const n=new URLSearchParams;if(void 0!==t.keys)for(let e of t.keys())n.set(e,t.get(e));a+=n,r={method:o}}fetch(a,r).then(checkStatus).then(parseJSON).then(function(e){n(e)}).catch(function(e){s(e)})}else{let o=new XMLHttpRequest;o.open("POST",e,!0),o.addEventListener("load",function(){4===o.readyState&&200===o.status&&n(o.response)}),o.addEventListener("error",function(e){s(e)}),o.addEventListener("timeout",function(){s("connection timeout")}),o.timeout=3e4,o.send(t)}})}async function getrandomWord(){return new Promise(function(e,t){SendAjax("../json/randomWord.json",new FormData,"GET").then(function(t){e(t)}).catch(function(e){console.error("request failed",e),t(e)})})}self.addEventListener("message",async function(e){console.log("Worker Task: Running task.");const t=e.data;await getrandomWord().then(function(e){randomWordList=e}).catch(function(e){console.error(e)});let o=0;switch(t.mode){case"createRandList":console.log("Worker Task: Create Random Word List");for(let e of randomWordList){let t="",n="";for(let o of e.tags)randomWordTags.includes(o,0)||randomWordTags.push(o),t+="<li>"+o+"</li>",n+='"'+o+'", ';n=n.slice(0,n.length-2),sendList={mode:"listResult",post:'<dt id="wordID'+ ++o+'"><h3>'+e.title+"</h3><h4>出典: "+e.original+"</h4></dt><dd>"+e.summary+'<div class="boxTag"><ul class="tagList">'+t+"</ul></div></dd>",SQL:"INSERT INTO `random_word` (`title`, `original`, `summary`, `tag`) VALUES ('"+e.title.replace("'","\\'")+"', '"+e.original.replace("'","\\'")+"', '"+e.summary.replace("'","\\'")+"', '"+n.replace("'","\\'")+"');"},postMessage(sendList)}randomWordTags.sort(),console.log(randomWordTags),sendList={mode:"tagList",post:randomWordTags},postMessage(sendList);break;default:console.log('Worker Task: Task mode "'+t.mode+'" is not found.')}}),console.log("Worker task is now running.");