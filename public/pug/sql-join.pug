extends ./_includes/_layout
block title
	- var title = 'JOIN(テーブル結合)';
	title #{title}
block headTitle
	h1 #{title}
block content
	section
		h2 注意
		p この記事は書きかけのページです。

	section
		h2 説明
		p
			| SQLデータベースではデータテーブル同士を参照し合うことが多い。その際使用するのが
			code.language-sql: span.token.keyword.keyword-JOIN JOIN
			| であるが、内部結合と外部結合の2種類があるためそれぞれについて説明する。

	section
		h2 使用方法と解説
		h3 使用するデータベース
		p
			s
				| 解説にあたり以下のデータベースを利用する。コピーすることで簡単に利用できる。尚このSQLコードは
				a(href='https://www.mysql.com/jp/' target='_blank') MySQL
				| もしくは
				a(href='https://mariadb.org/' target='_blank') MariaDB
				| で使用することを想定している。
			| 肥大化に伴い、サンプルデータに移行。

		h3 内部結合
		p
			| 内部結合を行う場合、
			code.language-sql
				span.token.keyword.keyword-INNER INNER
				span.token.keyword.space &nbsp;
				span.token.keyword.keyword-JOIN JOIN
			| を利用する。
			code.language-sql: span.token.keyword.keyword-ON ON
			| 句の内容の順序は特に定められていないが記述順序を定めておくとミスが少なくなる。
		pre.language-sql.line-numbers: code.
			SELECT
				`customer`.`name` AS `customerName`,
				`product`.`name` AS `productName`,
				`price`,
				`amount`
			FROM
				`order`
			INNER JOIN
				`customer`
					ON `customer`.`id` = `order`.`customerID`
			INNER JOIN
				`product`
					ON `product`.`id` = `order`.`productID`
			;

	section
		h2 使用上の注意
		ul
			li
				| まず起こりえないと思われるが、MySQLに置いて1つの参照に置いて結合できる
				code.language-sql: span.token.keyword.keyword-JOIN JOIN
				| 句の限界は61個である。
			li
				code.language-sql
					span.token.keyword.keyword-INNER INNER
					span.token.keyword.space &nbsp;
					span.token.keyword.keyword-JOIN JOIN
				| と
				code.language-sql
					span.token.keyword.keyword-OUTER OUTER
					span.token.keyword.space &nbsp;
					span.token.keyword.keyword-JOIN JOIN
				| は共存することができる。しかし複雑になりがちなのでデータベースの構造と目的を予めよく確認した上で行うこと。

	section
		h2 おまけ『INNER JOINとOUTER JOINの混在の例』
		p 作業工程にて実際に使用した例。複雑に見えるかもしれないが、実際のデータベースそのものは非常に単純な構造である。
		pre.language-sql.line-numbers: code.
			SELECT `name_f`, `gakuseki_num`, `school`.`name` AS `schoolName`, `school_course`.`name` AS `departmentName`, `school_class`.`name` AS `className`, IfNull(COUNT(`enq_answered`.`id`), 0) AS `answered` FROM `user` INNER JOIN `school` ON `school`.`id` = `user`.`school_id` INNER JOIN `school_course` ON `school_course`.`id` = `user`.`course_id` INNER JOIN `school_class` ON `school_class`.`id` = `user`.`class_id` INNER JOIN `post_movie` ON `post_movie`.`user_id` = `user`.`id` INNER JOIN `enq_group` ON DATE_FORMAT(`reserve_date`, '%Y-%c-%d %H:%i:%s') &gt;= DATE_FORMAT(`date_start`, '%Y-%c-%d %H:%i:%s') AND DATE_FORMAT(`reserve_date`, '%Y-%c-%d %H:%i:%s') &lt;= DATE_FORMAT(`date_end`, '%Y-%c-%d %H:%i:%s') LEFT OUTER JOIN `enq_answered` ON `enq_group`.`id` = `enq_answered`.`enq_group_id` AND `enq_answered`.`user_id` = `user`.`id` WHERE `user`.`is_regist` = 1 AND `user`.`is_delete` = 0 GROUP BY `user`.`id`, `enq_group`.`id`;
		p 整形した内容。
		pre.language-sql.line-numbers: code.
			SELECT
				`name_f`,
				`gakuseki_num`,
				`school`.`name` AS `schoolName`,
				`school_course`.`name` AS `departmentName`,
				`school_class`.`name` AS `className`,
				IfNull(COUNT(`enq_answered`.`id`), 0) AS `answered`
			FROM
				`user`
			INNER JOIN
				`school`
					ON `school`.`id` = `user`.`school_id`
			INNER JOIN
				`school_course`
					ON `school_course`.`id` = `user`.`course_id`
			INNER JOIN
				`school_class`
					ON `school_class`.`id` = `user`.`class_id`
			INNER JOIN
				`post_movie`
					ON `post_movie`.`user_id` = `user`.`id`
			INNER JOIN
				`enq_group`
					ON DATE_FORMAT(`reserve_date`, '%Y-%c-%d %H:%i:%s') &gt;= DATE_FORMAT(`date_start`, '%Y-%c-%d %H:%i:%s')
						AND DATE_FORMAT(`reserve_date`, '%Y-%c-%d %H:%i:%s') &lt;= DATE_FORMAT(`date_end`, '%Y-%c-%d %H:%i:%s')
			LEFT OUTER JOIN
				`enq_answered`
					ON `enq_group`.`id` = `enq_answered`.`enq_group_id`
						AND `enq_answered`.`user_id` = `user`.`id`
			WHERE
				`user`.`is_regist` = 1
				AND `user`.`is_delete` = 0
			GROUP BY
				`user`.`id`,
				`enq_group`.`id`
			;
